 ## Работа с правами суперпользователя
Суперпользователь — пользователь системы с UID=0 и обычно с регистрационным именем root. На суперпользователя не распространяются ограничения прав доступа, ему доступны любые файлы системы. Однако работа с правами суперпользователя может быть небезопасна. Начиная от ошибочных действий, которые могут повредить систему, заканчивая возможностью выполнения вредоносного кода с правами суперпользователя.    
Более того, повреждение системных файлов может выявиться не сразу, а только при последующей перезагрузке.  
Поэтому рекомендуется без необходимости не использовать учётную запись суперпользователя. По умолчанию в Ubuntu учётная запись пользователя root не имеет пароля и заблокирована. Это означает, что с логином root нельзя зарегистрироваться в системе непосредственно, или по сети, или локально через одну из виртуальных консолей.  

### SUDO
Как мы уже знаем, все действия от имени суперпользователя выполняется через систему sudo.  
Программа sudo имеет root в качестве владельца исполняемого файла и установленный атрибут SUID.    
Это не означает, что sudo будет выполнять все команды, которые её попросят сделать.  
При запуске sudo сверяется с файлом /etc/sudoers, чтобы проверить, может ли запустивший её пользователь получить права суперпользователя для выполнения команды. Если да, пользователю предлагается ввести пароль (не пароль рута, а собственный. Вдруг настоящий пользователь отошел, а за терминалом кто-то другой?), после чего запускает команду на исполнение с EUID=0, то есть с правами суперпользователя    

### /etc/sudoers
Файл настроек sudo — /etc/sudoers. Лучше не редактировать этот файл напрямую, для этого используют команду visudo (это не значит, что вы будете редактировать его с помощью vi. Будет вызван редактор по умолчанию, в т.ч. nano или mcedit):  
```bash
sudo visudo
```
Эта программа загружает файл в редактор и выполняет его блокировку, чтобы одновременно никто не выполнял его редактирование этой командой. После завершения редактирования программа выполняет проверку формата файла на правильность, чтобы никто его случайно не испортил. Строки файла /etc/sudoers в простейшем варианте имеют следующий формат:  
```bash
user host=command
```
User — имя пользователя или группы (если начинается с %). ALL для всех пользователей. Заданные пользователи или участники группы имеют права выполнять команды на указанных хостах с правами суперпользователя. host — обычно на этом месте строчка ALL, что идентифицирует все компьютеры в сети. Также здесь  может быть localhost, то есть локальный компьютер или имя/адрес компьютера. Поле полезно, когда в большой сети поддерживается единый файл /etc/sudoers и на разных компьютерах этой сети в sudo требуется разрешить разные команды. Command — может быть ALL для любой команды или список команд. Возможно указание опций, например, NOPASSWD: разрешает выполнение команды без запроса пароля. Команду обязательно надо указывать с полным путем. В качестве примера разрешим пользователю user через sudo выполнять остановку системы командой shutdown без запроса пароля. Это можно сделать, добавив в /etc/sudoers строчку:  
```bash
user ALL=NOPASSWD: /sbin/shutdown
```
Если же вы хотите назначить права через группу, создайте группу shutdown  и в /etc/sudoers укажите:  
```bash
%shutdown user ALL=NOPASSWD: /sbin/shutdown
```
Кроме выполнения команд от имени суперпользователя, sudo можно использовать для выполнения команд с любыми GID или UID. В таком варианте в /etc/sudoers используется более сложный формат:  
```bash
user host=(user:group) command
```
В таком варианте добавлены новые параметры user и group. При установке Ubuntu был создан пользователь с возможностью выполнять любые команды с любыми UID и GID через стандартную конфигурацию sudo. Такое право даёт пользователю членство в группе sudo, которая описана в стандартном /etc/sudoers строкой:  
```bash
%sudo ALL=(ALL:ALL) All
```
В разных версиях Linux данная группа может называться по-разному, в Ubuntu после 12 версии это группа sudo.  
sudo можно использовать для запуска команд от имени других пользователей и групп c помощью ключей -u и -g  
```bash
sudo -u petrov id  
```
```bash
sudo -u petrow -g developer id  
```
Обратите внимание, что во втором варианте использования EGID поменялся на developer, до этого была установлена первичная для petrov группа petrov. Иногда бывает необходимо выполнить подряд несколько команд и не хочется каждый раз набирать sudo перед командой. В таком случае, если вы уверены в своих силах, можно использовать sudo с параметром -i:  
```bash
sudo -i
```
После того, как оболочка суперпользователя больше не нужна, сеанс sudo надо завершить командой exit или комбинацией ^D.

### su
Кроме sudo, в UNIX есть более старая команда с похожим функционалом, команда su (switch user). В простейшем случае надо набрать su user, где user имя пользователя, в которого мы хотим переключиться. Система запросит пароль для этого пользователя и запустит оболочку c UID и GID пользователя. После завершения действий также нужно выйти с  помощью exit.  
Без параметров su запустит сеанс оболочки от имени рута. Придется указать пароль от рута, а после завершения действий также выполнить exit.  В отличие от sudo, для su надо знать пароль другого пользователя. В случае суперпользователя su не будет работать, пока не задать пароль пользователю root (по умолчанию пароля нет).  
```bash
sudo -c id pertrow
```
Все действия, выполняемые su, можно выполнить с помощью sudo, но знать su полезно, т. к. su есть в любой UNIX-системе, а sudo встречается не везде. 
